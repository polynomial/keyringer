#!/usr/bin/env ruby

# TODO
# - a lot of things

def usage
  puts "Usage:
#{File.basename($0)} TODO! "
  exit 1
end

# TODO: misc checks
def doDecrypt(someArguments)
  filename = ARGV[2]
  file     = Keyringer::Fs.new()
  content  = file.get_as_string(filename)

  crypt    = Keyringer::Crypt.new(nil)
  output   = crypt.decrypt(content)
  puts output
end

def doWrapper(someArguments)
  exec("keyringer " + ARGV.join(' '))
end

$:.unshift File.dirname(__FILE__) + '/../lib'
require 'keyringer'
begin 
  keyring = ARGV[0]
  action  = ARGV[1]
  if action == 'decrypt'
    doDecrypt(ARGV)
  else
    doWrapper(ARGV)
  end
rescue SystemExit => e
  exit e.status
rescue Exception => e
  puts "Fatal error: #{e.inspect}"
  exit 1
end

